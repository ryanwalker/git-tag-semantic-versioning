#!/usr/bin/env bash

set -e

# git checkout develop
# git pull

CURRENT_RELEASE_BRANCH_TAG=`git describe --match "release-branch-*"`
CURRENT_RELEASE_BRANCH=`echo "$CURRENT_RELEASE_BRANCH_TAG" | sed -E "s/(release-branch-[0-9]+).*/\1/"`
CURRENT_RELEASE_BRANCH_NUMBER=`echo "$CURRENT_RELEASE_BRANCH" | sed -E "s/release-branch-([0-9]+)/\1/"`

NEW_RELEASE_BRANCH_NUMBER=$((CURRENT_RELEASE_BRANCH_NUMBER+1))
NEW_RELEASE_BRANCH="release-branch-$NEW_RELEASE_BRANCH_NUMBER"

echo $CURRENT_RELEASE_BRANCH
echo $NEW_RELEASE_BRANCH

git checkout -b $NEW_RELEASE_BRANCH
# git push -u origin qa
#
#
# echo "#############################################"
# echo "qa branch created"
# echo "#############################################"
#
git checkout develop
NEW_VERSION=`./bin/next-version ALPHA MINOR`
echo "New version will be $NEW_VERSION"
# echo "$NEW_VERSION" >> .tags
#
# git add .tags
# git commit -m "$NEW_VERSION"
# git tag -am $NEW_VERSION "${NEW_VERSION}"
# git push
# git push --tags
#
# echo "#############################################"
# echo "develop branch now at version ${NEW_VERSION}"
# echo "#############################################"
